{% extends "base.html" %}

{% block head %}
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<!-- Favicon -->
<link rel="shortcut icon" href="{{ url_for('static', filename='img/favicon.ico') }}" type="image/x-icon">
<link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}" type="image/x-icon">
<style>
    /* Esconder a navbar na página de login */
    .navbar {
        display: none !important;
    }
    /* Ajustar o margin-top para compensar a navbar removida */
    .container-fluid {
        margin-top: 0 !important;
        padding-top: 0 !important;
    }
    /* Estilo para o fundo da página de login */
    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
    }
</style>
{% endblock %}

{% block content %}
<div class="row justify-content-center w-100">
    <div class="col-md-6 col-lg-4">
        <div class="card shadow-lg border-0">
            <div class="card-body p-5 text-center">
                <!-- Favicon no login -->
                <div class="mb-4">
                    <img src="{{ url_for('static', filename='img/favicon.ico') }}" 
                         alt="Logo do Sistema" 
                         width="250" 
                         height="250"
                         class="rounded-circle shadow-sm">
                </div>
                
                <h2 class="text-center mb-4 text-dark"></h2>
                
                <!-- Mostrar apenas mensagens de erro, não mensagens de info (logout) -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            {% if category != 'info' %}  <!-- Não mostrar mensagens de info -->
                            <div class="alert alert-{{ category }} alert-dismissible fade show">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
                <form method="POST" action="{{ url_for('login') }}">
                    <div class="mb-3">
                        <label for="username" class="form-label">Usuário</label>
                        <input type="text" class="form-control" id="username" name="username" required autocomplete="username">
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Senha</label>
                        <input type="password" class="form-control" id="password" name="password" required autocomplete="current-password">
                    </div>
                    <button type="submit" class="btn btn-primary w-100 py-2">Entrar</button>
                </form>
                <div class="text-center mt-3">
                    <!-- Espaço para links adicionais se necessário -->
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Prevenir cache e voltar após logout
window.history.forward();
window.onload = function() {
    window.history.forward();
};
window.onpageshow = function(evt) {
    if (evt.persisted) {
        window.location.reload();
    }
};

// Limpar cache ao sair
document.addEventListener('DOMContentLoaded', function() {
    if (performance.navigation.type === 2) {
        // Se a página foi carregada via cache (back/forward), recarregar
        location.reload();
    }
    
    // Remover qualquer resíduo de navbar que possa aparecer
    const navbar = document.querySelector('.navbar');
    if (navbar) {
        navbar.style.display = 'none';
    }
    
    // Remover margin do container
    const container = document.querySelector('.container-fluid');
    if (container) {
        container.style.marginTop = '0';
        container.style.paddingTop = '0';
    }
});
</script>
{% endblock %}
